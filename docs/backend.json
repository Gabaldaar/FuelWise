{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the FuelWise application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "User's username."
        }
      },
      "required": [
        "id",
        "email",
        "username"
      ]
    },
    "Vehicle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vehicle",
      "type": "object",
      "description": "Represents a vehicle managed within the FuelWise application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Vehicle entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns this vehicle. (Relationship: User 1:N Vehicle)"
        },
        "make": {
          "type": "string",
          "description": "Vehicle's make (e.g., Toyota)."
        },
        "model": {
          "type": "string",
          "description": "Vehicle's model (e.g., Camry)."
        },
        "year": {
          "type": "number",
          "description": "Vehicle's manufacturing year."
        },
        "licensePlate": {
          "type": "string",
          "description": "Vehicle's license plate number."
        },
        "fuelCapacity": {
          "type": "number",
          "description": "Vehicle's fuel tank capacity in liters."
        }
      },
      "required": [
        "id",
        "userId",
        "make",
        "model",
        "year",
        "licensePlate",
        "fuelCapacity"
      ]
    },
    "FuelRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FuelRecord",
      "type": "object",
      "description": "Represents a fuel purchase record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FuelRecord entity."
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to the Vehicle this fuel record belongs to. (Relationship: Vehicle 1:N FuelRecord)"
        },
        "date": {
          "type": "string",
          "description": "Date of the fuel purchase.",
          "format": "date-time"
        },
        "odometerReading": {
          "type": "number",
          "description": "Odometer reading at the time of the fuel purchase."
        },
        "fuelType": {
          "type": "string",
          "description": "Type of fuel purchased (e.g., Gasoline, Diesel)."
        },
        "pricePerLiter": {
          "type": "number",
          "description": "Price per liter of the fuel."
        },
        "totalCost": {
          "type": "number",
          "description": "Total cost of the fuel purchase."
        },
        "liters": {
          "type": "number",
          "description": "Number of liters of fuel purchased."
        },
        "gasStation": {
          "type": "string",
          "description": "Name of the gas station where the fuel was purchased."
        }
      },
      "required": [
        "id",
        "vehicleId",
        "date",
        "odometerReading",
        "fuelType",
        "pricePerLiter",
        "totalCost",
        "liters",
        "gasStation"
      ]
    },
    "ServiceReminder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceReminder",
      "type": "object",
      "description": "Represents a service reminder for a vehicle.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ServiceReminder entity."
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to the Vehicle this service reminder belongs to. (Relationship: Vehicle 1:N ServiceReminder)"
        },
        "serviceType": {
          "type": "string",
          "description": "Type of service to be performed (e.g., Oil Change, Tire Rotation)."
        },
        "dueDate": {
          "type": "string",
          "description": "Date when the service is due.",
          "format": "date-time"
        },
        "dueOdometerReading": {
          "type": "number",
          "description": "Odometer reading when the service is due."
        },
        "isCompleted": {
          "type": "boolean",
          "description": "Indicates whether the service has been completed."
        }
      },
      "required": [
        "id",
        "vehicleId",
        "serviceType",
        "dueDate",
        "dueOdometerReading",
        "isCompleted"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. User documents are created upon user registration. The `userId` parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}",
        "definition": {
          "entityName": "Vehicle",
          "schema": {
            "$ref": "#/backend/entities/Vehicle"
          },
          "description": "Stores vehicles owned by the user. The `userId` parameter corresponds to the Firebase Auth UID. Enforces path-based ownership: a vehicle can only be accessed by its owner (the user whose ID matches the `userId` parameter).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier of the vehicle."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}/fuel_records/{fuelRecordId}",
        "definition": {
          "entityName": "FuelRecord",
          "schema": {
            "$ref": "#/backend/entities/FuelRecord"
          },
          "description": "Stores fuel records for a specific vehicle.  Enforces path-based ownership.  A fuel record can only be accessed if the user owns the vehicle that the fuel record belongs to.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier of the vehicle."
            },
            {
              "name": "fuelRecordId",
              "description": "The unique identifier of the fuel record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vehicles/{vehicleId}/service_reminders/{serviceReminderId}",
        "definition": {
          "entityName": "ServiceReminder",
          "schema": {
            "$ref": "#/backend/entities/ServiceReminder"
          },
          "description": "Stores service reminders for a specific vehicle.  Enforces path-based ownership. A service reminder can only be accessed if the user owns the vehicle that the service reminder belongs to.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            },
            {
              "name": "vehicleId",
              "description": "The unique identifier of the vehicle."
            },
            {
              "name": "serviceReminderId",
              "description": "The unique identifier of the service reminder."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data consistency, security, and scalability for the FuelWise application.  The core principle is Authorization Independence achieved through path-based ownership and denormalization where required.  Vehicles and FuelRecords are structured as subcollections of the user document to ensure only the owner has access.  The structure facilitates secure `list` operations (QAPs) as each collection's documents share the same security requirements, and access is controlled through the user's `uid` and path-based rules.\n\nSpecifically:\n\n*   `/users/{userId}/vehicles/{vehicleId}`:  This path enforces that vehicles are owned by a specific user. Security rules can simply check that `request.auth.uid == userId` to ensure ownership.\n*   `/users/{userId}/vehicles/{vehicleId}/fuel_records/{fuelRecordId}`: This path ensures that fuel records are owned by a specific vehicle, which is owned by a specific user. Security rules can check that the request is made by the owner of the vehicle.\n*   `/users/{userId}/vehicles/{vehicleId}/service_reminders/{serviceReminderId}`: Same ownership and security pattern as fuel records.\n\nThis approach avoids any `get()` calls in the security rules, enabling atomic operations (transactions/batches) and easier debugging.\n"
  }
}